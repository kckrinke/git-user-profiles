#!/bin/bash
## git - git-user-profiles wrapper around real git binary
## Author: Kevin C. Krinke <kevin@krinke.ca>
## Copyright: GPLv2

ENABLE_ON_BASH_LOGIN=0
[ -f /etc/default/git-user-profiles ] && source /etc/default/git-user-profiles
if [ $ENABLE_ON_BASH_LOGIN -eq 1 ]
then
    # Force some sane defaults for internal network use
    export GIT_SSL_NO_VERIFY=1
    export GIT_FLUSH=1
    # Check if the KR_ env is setup or not
    if [ -n "${GUP_ENV_EXISTS}" ]
    then
        export GIT_AUTHOR_NAME="${GUP_USER_NAME}"
        export GIT_AUTHOR_EMAIL="${GUP_USER_EMAIL}"
        export GIT_COMMITTER_NAME="${GUP_USER_NAME}"
        export GIT_COMMITTER_EMAIL="${GUP_USER_EMAIL}"
        # Actually call out to the real git binary
        [ -n "$(which git.real)" ] && exec git.real "$@"
        # If we got this far, git.real doesn't exist :|
        echo "git-user-profiles: Missing git.real diversion." 1>&2
        exit 254
    fi
    echo "
git-user-profiles: Profile environment is missing. Using existing GIT config.
git-user-profiles: To disable this message, set ENABLE_ON_BASH_LOGIN=0 in the
git-user-profiles: global defaults file: '/etc/defaults/git-user-profiles'
git-user-profiles: or you can setup the current session's active profile by
git-user-profiles: using the BASH alias: 'git-user-profiles-select' which will
git-user-profiles: prompt you to select a profile as if you had started a new
git-user-profiles: BASH login session.
" 1>&2
fi
exec git.real "$@"
